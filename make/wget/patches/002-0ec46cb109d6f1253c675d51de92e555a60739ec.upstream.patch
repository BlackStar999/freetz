commit 0ec46cb109d6f1253c675d51de92e555a60739ec
Author: Tim RÃ¼hsen <tim.ruehsen@gmx.de>
Date:   Tue Apr 18 13:17:19 2017 +0200

    Skip iconv() usage if HAVE_ICONV is not defined
    
    This helps on broken iconv implementations, e.g. Solaris.
    
    Reported-by: Mojca Miklavec

index 75eaeea6..16de0bbb 100644
--- src/iri.c
+++ src/iri.c
@@ -119,6 +119,7 @@ check_encoding_name (const char *encoding)
   return true;
 }
 
+#ifdef HAVE_ICONV
 /* Do the conversion according to the passed conversion descriptor cd. *out
    will contain the transcoded string on success. *out content is
    unspecified otherwise. */
@@ -210,6 +211,15 @@ do_conversion (const char *tocode, const char *fromcode, char const *in_org, siz
     }
     return false;
 }
+#else
+static bool
+do_conversion (const char *tocode _GL_UNUSED, const char *fromcode _GL_UNUSED,
+               char const *in_org _GL_UNUSED, size_t inlen _GL_UNUSED, char **out)
+{
+  *out = NULL;
+  return false;
+}
+#endif
 
 /* Try converting string str from locale to UTF-8. Return a new string
    on success, or str on error or if conversion isn't needed. */
index 4aaef63b..30cd52b7 100644
--- src/url.c
+++ src/url.c
@@ -1544,6 +1544,7 @@ append_uri_pathel (const char *b, const char *e, bool escaped,
   append_null (dest);
 }
 
+#ifdef HAVE_ICONV
 static char *
 convert_fname (char *fname)
 {
@@ -1617,6 +1618,13 @@ convert_fname (char *fname)
 
   return converted_fname;
 }
+#else
+static char *
+convert_fname (char *fname)
+{
+  return fname;
+}
+#endif
 
 /* Append to DEST the directory structure that corresponds the
    directory part of URL's path.  For example, if the URL is
